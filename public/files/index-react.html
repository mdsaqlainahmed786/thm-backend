<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Instagram</title>
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.26.0/babel.min.js"></script>
    <script src="https://cdn.socket.io/4.8.0/socket.io.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        clifford: '#da373d',
                    }
                }
            }
        }
    </script>
    <style>
        :root {}

        body {
            background-color: #F2F2F2;
        }

        .bg-insta {
            background: linear-gradient(180deg, rgba(139, 47, 184, 1) 0%, rgba(103, 88, 205, 1) 51%, rgba(89, 116, 219, 1) 92%) no-repeat center;
        }

        .tidot {
            -webkit-animation: mercuryTypingAnimation 1.5s infinite ease-in-out;
        }

        @-webkit-keyframes mercuryTypingAnimation {
            0% {
                -webkit-transform: translateY(0px)
            }

            28% {
                -webkit-transform: translateY(-5px)
            }

            44% {
                -webkit-transform: translateY(0px)
            }
        }

        .tidot:nth-child(1) {
            -webkit-animation-delay: 200ms;
        }

        .tidot:nth-child(2) {
            -webkit-animation-delay: 300ms;
        }

        .tidot:nth-child(3) {
            -webkit-animation-delay: 400ms;
        }
    </style>
</head>

<body>
    <div id="app"></div>
    <script type="text/babel">

        const URL = window.location.origin;
        const socket = io(URL, { autoConnect: false });
        const RandomProfiles = [`https://randomuser.me/api/portraits/women/30.jpg`, `https://randomuser.me/api/portraits/men/95.jpg`, `https://randomuser.me/api/portraits/men/91.jpg`, `https://randomuser.me/api/portraits/men/90.jpg`];
        localStorage.setItem("currentPage", 1);
        class ErrorBoundary extends React.Component {
            constructor(props) {
                super(props);
                this.state = { hasError: false };
            }

            static getDerivedStateFromError(error) {
                // Update state so the next render will show the fallback UI.
                return { hasError: true };
            }

            componentDidCatch(error, info) {
                // Example "componentStack":
                //   in ComponentThatThrows (created by App)
                //   in ErrorBoundary (created by App)
                //   in div (created by App)
                //   in App
                logErrorToMyService(error, info.componentStack);
            }

            render() {
                if (this.state.hasError) {
                    // You can render any custom fallback UI
                    return this.props.fallback;
                }

                return this.props.children;
            }
        }

        function App() {
            const [accounts, setAccounts] = React.useState(['atulappcrunk84', 'prime59']);
            const [username, setUsername] = React.useState('');
            const [loginForm, showLoginForm] = React.useState(true);
            const [onlineUsers, setOnlineUsers] = React.useState([]);
            const [inChatView, setChatView] = React.useState(false);
            const [onlineStatus, setOnlineStatus] = React.useState('');
            const [type, setTyping] = React.useState(null);//for
            const [chatScreen, setChatScreen] = React.useState({
                name: '',
                profilePic: '',
                username: '',
            });
            const [messages, setMessages] = React.useState({
                messages: [],
                pageNo: 1,
                totalMessages: 1,
                totalPages: 1,
            });
            const [message, setMessage] = React.useState('');

            React.useEffect(() => {
                localStorage.setItem("currentPage", 1);
            }, []);

            React.useEffect(() => {
                console.log(inChatView, loginForm);
                if (!inChatView && !loginForm) {
                    socket.emit("users");
                    socket.emit("chat screen");
                    socket.emit("in chat");
                }
            }, [inChatView, loginForm])

            React.useEffect(() => {
                //Done
                function onConnect() {
                    Toastify({
                        text: "ChatScreen:: onConnect",
                        className: "info",
                        style: {
                            background: "linear-gradient(to right, #00b09b, #96c93d)",
                        }
                    }).showToast();
                }
                function onDisconnect(data) {
                    Toastify({
                        text: "ChatScreen:: onDisconnect",
                        className: "info",
                        style: {
                            background: "linear-gradient(to right, #00b09b, #96c93d)",
                        }
                    }).showToast();
                    console.log(data);
                    socket.emit("users");
                }

                //Done
                function onUsers(data) {
                    // Toastify({
                    //     text: "ChatScreen:: onUsers",
                    //     className: "info",
                    //     style: {
                    //         background: "linear-gradient(to right, #00b09b, #96c93d)",
                    //     }
                    // }).showToast();
                    setOnlineUsers(data);
                    console.log(data);
                }

                //Done
                function onChatScreen(data) {
                    // Toastify({
                    //     text: "ChatScreen:: onChatScreen",
                    //     className: "info",
                    //     style: {
                    //         background: "linear-gradient(to right, #00b09b, #96c93d)",
                    //     }
                    // }).showToast();
                    setMessages(data);
                }

                function onLastSeen(data) {
                    // console.log("ChatScreen:: onLastSeen")
                    setOnlineStatus(data)
                }
                //Done
                function onMessageSeen() {
                    // Toastify({
                    //     text: "onMessageSeen",
                    //     className: "info",
                    //     style: {
                    //         background: "linear-gradient(to right, #00b09b, #96c93d)",
                    //     }
                    // }).showToast();
                    if (inChatView) {
                        const currentPage = localStorage.getItem('currentPage')
                        socket.emit("fetch conversations", { username: chatScreen.username, pageNumber: currentPage });
                    } else {
                        socket.emit("chat screen");
                    }
                }
                //Done
                function onPrivateMessage(data) {
                    // Toastify({
                    //     text: "MessageScreen:: onPrivateMessage",
                    //     className: "info",
                    //     style: {
                    //         background: "linear-gradient(to right, #00b09b, #96c93d)",
                    //     }
                    // }).showToast();
                    console.log(data);
                    if (!inChatView) {
                        setTimeout(() => {
                            socket.emit("chat screen");
                        }, 500)
                    }
                    if (data && chatScreen && data.from === chatScreen.username) {
                        const messageData = {
                            'createdAt': new Date().toISOString(),
                            'fullName': '',
                            'gender': '',
                            'isOnline': false,
                            'isSeen': data.isSeen,
                            'message': data.message.message,
                            'profilePicture': '',
                            'sentByMe': false,
                            'targetUserID': '',
                            'type': data.message.type,
                            'unseenCount': 0,
                            'userID': '',
                            'username': '',
                            '_id': '',
                            'link': '',
                            'contact': '',
                            'mediaUrl': '',
                            'gift': '',
                            'location': {
                                lat: 0,
                                lng: 0,
                                placeName: ''
                            }
                        }
                        setMessages({
                            ...messages,
                            messages: [...messages.messages, messageData]
                        })
                    }
                }

                //Done
                function onFetchConversations(data) {
                    console.log(data);
                    // Toastify({
                    //     text: "MessageScreen:: onFetchConversations",
                    //     className: "info",
                    //     style: {
                    //         background: "linear-gradient(to right, #00b09b, #96c93d)",
                    //     }
                    // }).showToast();
                    setMessages({
                        ...messages,
                        messages: data.messages.reverse(),
                        pageNo: data.pageNo,
                        totalMessages: data.totalMessages,
                        totalPages: data.totalPages
                    })
                }


                function onTyping(data) {
                    console.log('data', data);
                    setTyping(data.username)
                }
                function stopTyping(data) {
                    setTyping(null)
                    console.log("stop typing", data)
                }
                function onUserConnect() {
                    // Toastify({
                    //     text: "MessageScreen:: onUserConnect",
                    //     className: "info",
                    //     style: {
                    //         background: "linear-gradient(to right, #00b09b, #96c93d)",
                    //     }
                    // }).showToast();
                    socket.emit("users");
                }

                /** Default handler */
                socket.on('connect', onConnect);
                socket.on('user disconnected', onDisconnect);
                socket.on('user connected', onUserConnect)
                socket.on("users", onUsers);
                socket.on("chat screen", onChatScreen);
                socket.on('fetch conversations', onFetchConversations);
                socket.on('private message', onPrivateMessage);
                socket.on('last seen', onLastSeen);
                socket.on('message seen', onMessageSeen);
                socket.on('typing', onTyping);
                socket.on("stop typing", stopTyping)
                return () => {
                    socket.off('connect', onConnect);
                    socket.off('user disconnected', onDisconnect);
                    socket.off('user connected', onUserConnect);
                    socket.off("users", onUsers);
                    socket.off("chat screen", onChatScreen);
                    socket.off('fetch conversations', onFetchConversations);
                    socket.off('private message', onPrivateMessage);
                    socket.off('last seen', onLastSeen);
                    socket.off('message seen', onMessageSeen);
                    socket.off('typing', onTyping);
                    socket.off('stop typing', stopTyping);
                };
            }, [socket, chatScreen, messages]);


            const handleUserListClick = (user) => {
                const senderID = user.username;
                setChatScreen({
                    ...chatScreen,
                    username: senderID,
                    name: user.name,
                    profilePic: user.profilePic.small
                });
                setChatView(true);
                setOnlineStatus(user.isOnline ? 'Online' : '');
                const currentPage = localStorage.getItem('currentPage')
                socket.emit("fetch last seen", senderID);
                socket.emit("fetch conversations", { username: senderID, pageNumber: currentPage });
                socket.emit("in private chat", senderID);
                socket.emit("message seen", senderID);
                // scrollToBottom();
            }

            const handelSubmit = (event) => {
                event.preventDefault();
                const randomIndex = Math.floor(Math.random() * RandomProfiles.length);
                const image = RandomProfiles[randomIndex]
                socket.auth = { username };
                socket.connect();
                showLoginForm(false);
            }
            const handelSendMessage = (e) => {
                e.preventDefault();
                if (message.length === 0) return false;
                const messageData = {
                    'createdAt': new Date().toISOString(),
                    'fullName': '',
                    'gender': '',
                    'isOnline': false,
                    'isSeen': false,
                    'message': message,
                    'profilePicture': '',
                    'sentByMe': true,
                    'targetUserID': '',
                    'type': 'text',
                    'unseenCount': 0,
                    'userID': '',
                    'username': '',
                    '_id': '',
                    'link': '',
                    'contact': '',
                    'mediaUrl': '',
                    'gift': '',
                    'location': {
                        lat: 0,
                        lng: 0,
                        placeName: ''
                    }
                }
                setMessages({
                    ...messages, messages: [...messages.messages, messageData]
                })
                socket.emit("private message", {
                    message: {
                        type: messageData.type,
                        message: messageData.message
                    },
                    to: chatScreen.username
                });
                setMessage('');
            }


            const [typingTimeout, setTypingTimeout] = React.useState(null);
            const handleChange = (e) => {
                const value = e.target.value;

                setMessage(value)
                if (typingTimeout) {
                    clearTimeout(typingTimeout);
                }
                socket.emit("typing");
                const newTimeout = setTimeout(() => {
                    socket.emit("stop typing");
                }, 1500);
                setTypingTimeout(newTimeout); // Save the timeout ID to clear it later
            };
            const handleStoryComment = () => {
                const messageData = {
                    'createdAt': new Date().toISOString(),
                    'fullName': '',
                    'gender': '',
                    'isOnline': false,
                    'isSeen': false,
                    'message': message,
                    'profilePicture': '',
                    'sentByMe': true,
                    'targetUserID': '',
                    'type': 'pdf',
                    'unseenCount': 0,
                    'userID': '',
                    'username': '',
                    '_id': '',
                    'link': '',
                    'contact': '',
                    'mediaUrl': '',
                    'gift': '',
                    'location': {
                        lat: 0,
                        lng: 0,
                        placeName: ''
                    }
                }
                setMessages({
                    ...messages, messages: [...messages.messages, messageData]
                })
                socket.emit("private message", {
                    message: {
                        type: messageData.type,
                        message: messageData.message,
                        mediaID: "6784afafc72bbb80bd19202b",
                        // storyID: "677f72c0f0675714367d7ade",
                        // mediaUrl: "https://the-hotel-media-bucket.s3.ap-south-1.amazonaws.com/story/df9d0528-e4f0-471e-8a39-806d72fef90f-1736405695991-1080x1980.jpg"
                    },
                    to: chatScreen.username
                });
                setMessage('');
            }
            return (
                <div className="flex justify-center">
                    <div className="w-[375px] h-[812px] bg-white overflow-y">
                        {
                            loginForm && <div className="px-4 py-40">
                                <div className="mb-2 flex justify-center">
                                    <svg width="105" height="28" viewBox="0 0 105 28" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path fillRule="evenodd" clipRule="evenodd" d="M0.146219 6.33102C0.892414 3.33158 3.25507 0.943696 5.40422 0.0973953C6.30312 -0.256642 8.20784 0.420698 8.22128 1.06631C8.26762 3.29993 8.2572 6.79111 8.25147 8.71074C8.25045 9.0532 8.24958 9.34565 8.2492 9.57201C8.24894 9.72447 8.24872 9.88767 8.2485 10.0597C8.2463 11.7276 8.243 14.229 8.18292 15.8618C8.12796 17.356 7.82238 18.732 6.94928 19.8776C6.22111 20.8329 4.96326 21.4257 4.66863 21.1765C4.48768 21.0235 4.59508 20.7029 4.7502 20.2398C4.82097 20.0285 4.90167 19.7876 4.96944 19.5195C5.18312 18.6748 5.30207 17.82 5.30207 15.1132C5.30207 13.9572 5.32302 10.2688 5.34071 7.15448C5.35363 4.87923 5.36481 2.91046 5.36481 2.4597C5.36481 2.43327 5.36484 2.40739 5.36486 2.38206C5.36544 1.83512 5.36574 1.55006 5.08432 1.77172C3.49932 3.02007 2.24005 5.86517 2.52849 8.41138C2.64931 9.47837 3.02237 10.0292 3.27904 10.4082C3.4966 10.7294 3.63054 10.9271 3.45638 11.2111C3.13383 11.7373 -0.798808 10.1304 0.146219 6.33102ZM103.956 15.1281C104.074 14.6197 104.216 14.3175 104.528 14.3175C104.93 14.3175 105.063 14.7942 104.973 15.4114C104.597 17.9762 103.483 18.9509 102.119 18.9509C101.481 18.9509 99.6483 18.6585 99.0149 16.0455C98.5476 14.1167 98.6627 10.5899 98.7139 9.51171C98.7153 9.48247 98.6736 9.33211 98.5838 9.52284L98.5643 9.56435C98.3061 10.1128 97.6553 11.4948 97.2609 13.0203C96.6411 15.4179 96.5876 17.0864 96.6181 17.3564C96.6809 17.9103 95.9798 17.9973 95.6445 17.9973C95.1175 17.9973 94.4702 17.9561 93.9462 17.0857C93.7626 16.7814 93.5236 15.8196 93.3448 14.1926C93.1107 12.0662 93.0741 10.4625 93.06 9.84324L93.0584 9.77304C93.0521 9.49592 92.8764 9.53912 92.7207 9.80095L92.6971 9.84045C92.4103 10.3211 91.8389 11.2789 91.2274 13.6459C90.9382 14.7658 90.8956 16.1845 90.8619 17.3074L90.8619 17.3084C90.852 17.6392 90.8428 17.9443 90.8283 18.2085C90.8041 18.6507 90.627 18.822 90.3999 18.8652C90.0721 18.9275 89.1859 19.0707 88.317 18.7679C88.1207 18.6994 87.8508 18.5577 87.8045 18.4447C87.7285 18.2601 87.6804 17.6745 87.6498 16.9583C86.9185 18.5849 86.0171 18.9509 85.0673 18.9509C84.1555 18.9509 82.5636 18.3565 82.2358 16.4323C82.2358 16.4323 82.0401 16.8157 81.6953 17.2593C80.1676 19.2254 77.1579 19.7275 75.601 17.4087C75.5251 17.2957 75.4557 17.1734 75.3892 17.047C74.8378 18.1809 73.8088 18.9445 72.7332 18.9445C71.8143 18.9445 70.2645 18.359 69.577 16.5393C68.5869 13.9191 69.6421 10.0046 69.7356 9.65777L69.739 9.64495C69.7937 9.44143 69.7088 9.38478 69.4135 9.40289C68.4902 9.4597 67.6251 9.45273 67.6251 9.45273C67.1152 10.9644 66.1194 12.9069 65.1903 14.3533C64.3377 15.6804 63.4118 16.8144 62.5899 17.7116C62.6003 18.3864 62.6124 19.0351 62.6234 19.628C62.6315 20.0617 62.639 20.4655 62.6449 20.8278C62.6799 22.969 62.2027 25.1369 61.4736 26.1442C60.6453 27.2885 59.2955 28.1062 57.7222 27.9888C56.2379 27.8781 54.2791 27.0338 54.4456 24.7621C54.5762 22.9829 56.35 21.4547 58.6865 19.4417L58.6962 19.4334C59.2275 18.9755 60.093 18.2292 60.093 18.2292L60.0484 17.008C59.9942 17.0832 59.9321 17.167 59.8605 17.2593C58.3434 19.2284 55.3231 19.7275 53.7662 17.4087C53.663 17.255 53.5684 17.0929 53.4818 16.9231C52.7427 18.4872 51.6881 18.9411 50.6667 18.9411C49.7547 18.9411 48.162 18.2915 47.9407 16.4323C47.9407 16.4323 47.8693 16.6509 47.4002 17.2593C45.8831 19.2284 42.8628 19.7275 41.3059 17.4087C40.9809 16.9246 40.7292 16.3522 40.5592 15.694C39.9669 17.3087 38.6125 18.9499 37.2617 18.9499C35.2412 18.9499 34.0783 17.2754 33.805 14.3159C32.2785 17.7426 30.0857 19.0711 27.3484 18.985C26.6459 18.9629 25.5442 18.7685 25.0317 18.554C24.4364 18.3048 23.8622 18.0199 24.0199 17.481C24.1819 16.9271 24.4658 16.4797 24.9621 16.1279C25.1531 15.9925 25.4718 16.0312 25.6805 16.1603C25.8489 16.2645 25.9752 16.3545 26.0958 16.4404L26.0959 16.4405L26.096 16.4406L26.0961 16.4406L26.0961 16.4406C26.2537 16.5528 26.4014 16.6581 26.6202 16.7789C27.9458 17.5099 28.6906 16.7578 28.8883 16.0279C29.1469 15.0733 28.7572 14.067 27.5702 13.0081C27.25 12.7224 26.9297 12.4482 26.623 12.1857L26.6228 12.1855L26.6224 12.1852C26.4401 12.0291 26.2626 11.8772 26.0928 11.7295C25.4393 12.765 24.5296 14.2017 23.5927 15.6671C22.0899 18.0184 20.688 18.9473 19.6934 18.9473C18.3935 18.9473 17.4838 18.0761 17.6733 13.3757C17.7107 12.4481 17.7576 11.4337 17.7979 10.5611L17.7979 10.5607L17.798 10.5586C17.834 9.78001 17.8648 9.11452 17.8789 8.72455C17.8856 8.53748 17.746 8.54429 17.6236 8.65859C16.9241 9.31251 15.4367 11.1538 14.2956 14.9276C13.6718 16.9907 13.5765 17.7686 13.5084 18.325C13.4964 18.4224 13.4853 18.5129 13.4724 18.6024C13.3999 19.1038 12.004 18.9353 11.7492 18.886C11.4754 18.8328 11.3093 18.7041 11.1656 18.5353C11.0219 18.3661 10.9058 18.0819 10.834 17.7325C10.7621 17.3836 10.7432 16.5858 10.7432 15.9017L10.8045 6.90003C10.8045 6.60763 10.9721 6.46093 11.3075 6.46093C12.0116 6.46093 12.8036 6.77045 13.1002 6.9218C13.2751 7.01101 13.3517 7.14143 13.3517 7.27633L13.314 13.03C13.314 13.03 13.7497 11.9312 13.9715 11.3281C15.7311 6.5435 17.5934 6.46093 18.2389 6.46093C18.6701 6.46093 19.4147 6.85784 19.7636 7.05969C20.3378 7.39197 20.6804 7.7588 20.6544 8.40274C20.6355 8.87089 20.6155 9.3352 20.596 9.78784L20.5959 9.79105L20.5957 9.79352L20.5957 9.79469C20.5342 11.222 20.4776 12.5328 20.4776 13.4814L20.4776 13.5381V13.5381C20.4775 14.9725 20.4774 16.4823 21.0119 16.4823C21.6514 16.4823 22.4859 15.1224 23.5754 13.3469L23.7724 13.026C24.2 12.3309 24.7047 11.4346 25.0722 10.7689C25.0225 10.715 24.9744 10.6615 24.9301 10.6092C24.3224 9.89282 24.157 9.20335 24.4672 8.27382C24.8675 7.07415 26.2097 5.9504 27.8374 6.30227C28.8226 6.51509 28.8053 7.48002 28.4039 8.32349C27.8374 9.5142 27.1987 10.1058 27.1987 10.1058C28.3016 10.8729 29.2872 11.5728 29.7865 11.9425C31.1418 12.9458 31.8941 14.131 31.5258 15.7093C31.5258 15.7093 33.2409 14.4206 33.7278 12.035C33.7269 11.9009 33.7262 11.7629 33.7262 11.6195C33.7262 10.2713 33.7656 5.90487 33.7656 5.90487C33.4144 5.89498 32.9922 5.88519 32.5629 5.87524L32.5627 5.87523L32.5626 5.87523C31.9106 5.86011 31.2422 5.84461 30.7805 5.82779C30.1149 5.80386 30.6345 3.85757 31.116 3.85757C31.3751 3.85757 31.9471 3.88137 32.519 3.90517C33.0909 3.92897 33.6627 3.95277 33.9217 3.95277C33.9217 3.95277 33.9705 1.46321 34.0647 0.61325C34.1272 0.0532029 34.4475 -0.0807034 35.1534 0.0561934C35.6644 0.155211 36.0954 0.246919 36.5772 0.438474L36.5934 0.444886C36.7936 0.523902 37.1203 0.652869 37.0981 0.897178C37.0712 1.19838 36.9558 4.04962 36.9558 4.04962C36.9558 4.04962 38.2425 4.13917 38.7046 4.14897C39.2543 4.15994 40.6408 4.22938 40.837 4.30863C41.2698 4.48374 40.8658 5.89856 40.4464 5.91866C39.8398 5.94783 39.374 5.94849 38.9243 5.94913C38.7541 5.94938 38.5862 5.94961 38.4139 5.95139C38.1702 5.95405 36.9116 5.97415 36.9116 5.97415C36.878 6.38817 36.6794 10.6836 36.6794 13.7007C36.6794 15.9656 37.2345 17.0284 37.8174 17.0284C38.8135 17.0284 40.0312 15.2017 40.3069 13.6166C40.3022 13.0586 40.3389 12.4613 40.4222 11.8237C40.7103 9.61704 41.27 8.62022 41.9614 7.72108C43.0217 6.34215 44.4093 6.00605 45.7465 6.3792C46.2429 6.51742 46.9891 6.9944 47.4531 7.67971V7.18546C47.4531 6.97097 47.6933 6.68339 48.0349 6.65963C48.2938 6.64153 48.631 6.67276 49.0216 6.75766C49.3949 6.83906 50.1971 7.05886 50.2037 7.49497C50.2045 7.55514 50.1988 7.70227 50.1906 7.91392L50.1906 7.91432C50.1794 8.20234 50.1636 8.60972 50.1533 9.07992C50.1429 9.5577 50.1289 9.97125 50.1149 10.3847V10.3847V10.3848V10.3849V10.385L50.1149 10.3853C50.0874 11.1975 50.06 12.0094 50.06 13.3073C50.06 16.6652 50.5628 17.3999 51.4465 17.3999C52.1377 17.3999 52.7491 16.3668 52.9617 15.379C52.7646 14.3923 52.7379 13.2214 52.8825 11.8433C53.0377 10.3647 53.5854 8.82107 54.4217 7.72108C55.4742 6.33683 56.8696 6.00605 58.2068 6.3792C58.7032 6.51742 59.4494 6.9944 59.9134 7.67971C59.9134 7.67971 59.9134 7.29411 59.9116 7.23131C59.9028 6.89871 60.2427 6.6176 60.8068 6.6588C61.2538 6.69137 61.6847 6.78474 62.0491 6.91964C62.4613 7.07215 62.6594 7.19277 62.6643 7.51158C62.6652 7.57117 62.6595 7.71288 62.6514 7.91746L62.6514 7.91785C62.6401 8.20153 62.624 8.60598 62.6136 9.07992C62.5952 9.91326 62.5537 12.2247 62.5636 15.1619C62.5643 15.3682 62.5655 15.5757 62.5671 15.783C63.0017 15.2261 63.3384 14.7023 63.7785 13.9954C64.6002 12.6759 65.396 10.8511 65.7207 9.45389C65.7207 9.45389 64.7311 8.91594 64.8914 7.77541C64.9925 7.0567 65.2589 6.65698 65.6502 6.31806C66.3057 5.75037 68.3603 5.60616 68.1394 7.38349C68.0973 7.72241 68.0461 7.91463 68.0461 7.91463C68.8955 7.79634 69.8239 7.64233 70.4732 7.49912C71.3848 7.29826 72.019 7.46158 72.3166 7.78122C72.6411 8.12978 72.7705 8.49345 72.6112 9.18807C72.5446 9.47894 72.4789 9.75377 72.4158 10.0182L72.4153 10.0201L72.4151 10.0208L72.4151 10.0211C72.1247 11.2365 71.887 12.2315 71.8451 13.5488C71.7677 15.989 72.4343 17.3999 73.3539 17.3999C73.9873 17.3999 74.5658 16.881 74.8774 15.6147C74.6195 14.4925 74.5722 13.1656 74.7173 11.8569C74.9157 10.0669 75.42 8.82107 76.2565 7.72108C77.309 6.33683 78.7043 6.00589 80.0415 6.3792C80.538 6.51742 81.2842 6.9944 81.7482 7.67971C81.7482 7.67971 81.7462 7.36837 81.7462 7.2044C81.7462 6.89887 82.0011 6.67691 82.3613 6.65764C82.6158 6.64402 82.9417 6.67592 83.3167 6.75766C83.69 6.8389 84.4922 7.0587 84.4987 7.4948C84.4996 7.55495 84.4939 7.70176 84.4856 7.9129V7.91318V7.91345V7.91374V7.91404V7.9142L84.4856 7.91457L84.4856 7.91578C84.4744 8.2037 84.4586 8.6104 84.4484 9.07975C84.438 9.55784 84.424 9.97161 84.41 10.3853C84.3825 11.1976 84.3551 12.0095 84.3551 13.3073C84.3551 16.6652 84.772 17.3999 85.6557 17.3999C86.5383 17.3999 87.3499 15.6425 87.6002 14.3479C87.5996 14.2061 87.5995 14.0727 87.5995 13.9502C87.5995 11.4512 87.6557 7.99876 87.6684 7.21996L87.6709 7.06002C87.6709 6.71363 87.7817 6.47605 88.2341 6.47605C88.6009 6.47605 89.4648 6.67592 89.9033 6.79537C90.0007 6.82212 90.3237 6.96965 90.3216 7.4124C90.3168 8.58599 90.3115 11.68 90.3115 11.68C90.3115 11.68 90.591 10.9043 90.9922 9.75759C91.4858 8.34675 91.9609 7.15655 92.3711 6.71429C92.8446 6.17352 94.1595 6.62807 94.5925 6.88508C95.2599 7.28115 95.388 7.76494 95.3921 8.3333C95.4114 10.9887 95.555 12.3757 95.6381 13.1781C95.6462 13.2559 95.6536 13.3282 95.6604 13.3957C95.6717 13.511 95.736 13.5008 95.7422 13.4515C95.8621 12.499 96.3714 10.154 97.6733 7.20024C98.1325 6.15827 99.0532 6.47258 99.6896 6.68983L99.6961 6.69203C101.176 7.19725 101.328 7.71028 101.298 8.2288C101.155 10.7524 101.137 13.2893 101.249 14.6674C101.392 16.42 101.947 17.2954 102.566 17.2954C103.119 17.2954 103.548 16.8963 103.956 15.1281ZM80.9086 16.0484C81.3199 15.2725 81.6513 14.1725 81.7206 12.7653C81.8611 9.90778 81.2639 8.36237 79.988 8.24973C78.6944 8.13576 77.9133 9.3994 77.6335 11.0726C77.3587 12.715 77.3765 14.6807 77.7588 15.8576C78.4603 18.0167 80.1124 17.5504 80.9086 16.0484ZM60.211 21.4962C60.1937 23.8344 59.8022 25.8845 58.9627 26.4799C57.772 27.3242 56.1716 26.6909 56.503 24.9847C56.7962 23.4748 58.1829 21.9329 60.2144 20.0489C60.2144 20.0489 60.2186 20.4786 60.211 21.4962ZM59.0739 16.0484C59.4595 15.3208 59.813 14.0333 59.8858 12.7515C60.0664 9.57135 59.4346 8.2499 58.1532 8.2499C56.8353 8.2499 56.1015 9.7001 55.7987 11.2633C55.5654 12.4681 55.4525 14.3802 55.924 15.8576C56.6137 18.0199 58.2778 17.5504 59.0739 16.0484ZM47.4255 12.7321C47.3474 14.0894 47.0657 15.2242 46.6135 16.0484C45.7956 17.5401 44.1774 18.0131 43.4637 15.8576C42.9492 14.3033 43.1244 12.184 43.3384 11.0392C43.656 9.34025 44.4513 8.13576 45.6929 8.2499C46.9683 8.36702 47.5883 9.90777 47.4255 12.7321Z" fill="#262626" />
                                    </svg>
                                </div>
                                <div className="flex flex-wrap gap-4 mb-4">
                                    {accounts && accounts.map((data) => {
                                        return (<div className="text-sm bg-black/20 px-2 py-1 rounded-md cursor-pointer" key={data} onClick={(e) => setUsername(data)}>{data}</div>)
                                    })}
                                </div>
                                <form onSubmit={handelSubmit}>
                                    <div className="flex flex-col gap-5">
                                        <input type="text" value={username} onChange={(e) => setUsername(e.target.value)} className="text-sm py-2 rounded-[5px] w-full border border-[#FAFAFA] p-2 outline-0 bg-black/10" placeholder="Enter your username" />
                                        <button type="submit" className="flex justify-center text-sm bg-[#3797EF] w-full text-white py-2 rounded-[5px]">Login</button>
                                    </div>
                                </form>
                            </div>
                        }
                        {
                            !loginForm &&
                            <div>
                                {
                                    !inChatView &&
                                    <div className="px-2">
                                        <div className="h-11 flex items-center gap-2">
                                            <button type="button" onClick={(e) => {
                                                showLoginForm(true);
                                                setChatView(false);
                                                socket.emit("leave chat")
                                            }}>
                                                <svg width="22px" height="22px" viewBox="0 0 512 512" version="1.1" xmlSpace="preserve" xmlns="http://www.w3.org/2000/svg" xmlnsXlink="http://www.w3.org/1999/xlink">
                                                    <path className="st0" d="M217,129.88c-6.25-6.25-16.38-6.25-22.63,0L79.61,244.64c-0.39,0.39-0.76,0.8-1.11,1.23    c-0.11,0.13-0.2,0.27-0.31,0.41c-0.21,0.28-0.42,0.55-0.62,0.84c-0.14,0.21-0.26,0.43-0.39,0.64c-0.14,0.23-0.28,0.46-0.41,0.7    c-0.13,0.24-0.24,0.48-0.35,0.73c-0.11,0.23-0.22,0.45-0.32,0.68c-0.11,0.26-0.19,0.52-0.28,0.78c-0.08,0.23-0.17,0.46-0.24,0.69    c-0.09,0.29-0.15,0.58-0.22,0.86c-0.05,0.22-0.11,0.43-0.16,0.65c-0.08,0.38-0.13,0.76-0.17,1.14c-0.02,0.14-0.04,0.27-0.06,0.41    c-0.11,1.07-0.11,2.15,0,3.22c0.01,0.06,0.02,0.12,0.03,0.18c0.05,0.46,0.12,0.92,0.21,1.37c0.03,0.13,0.07,0.26,0.1,0.39    c0.09,0.38,0.18,0.76,0.29,1.13c0.04,0.13,0.09,0.26,0.14,0.4c0.12,0.36,0.25,0.73,0.4,1.09c0.05,0.11,0.1,0.21,0.15,0.32    c0.17,0.37,0.34,0.74,0.53,1.1c0.04,0.07,0.09,0.14,0.13,0.21c0.21,0.38,0.44,0.76,0.68,1.13c0.02,0.03,0.04,0.06,0.06,0.09    c0.55,0.81,1.18,1.58,1.89,2.29l114.81,114.81c3.12,3.12,7.22,4.69,11.31,4.69s8.19-1.56,11.31-4.69c6.25-6.25,6.25-16.38,0-22.63    l-87.5-87.5h291.62c8.84,0,16-7.16,16-16s-7.16-16-16-16H129.51L217,152.5C223.25,146.26,223.25,136.13,217,129.88z" />
                                                </svg>
                                            </button>
                                            <div className="text-base font-medium tracking-normal" >
                                                {username}
                                            </div>
                                            <input type="text" id="search" className="form-control form-control-sm hidden" />
                                        </div>
                                        <div className="rounded-[5px] w-full border border-[#FAFAFA] bg-black/10 flex justify-start items-center gap-1.5 py-2 px-2.5">
                                            <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path fill-rule="evenodd" clip-rule="evenodd" d="M11.5 5.75C11.5 2.57436 8.92564 0 5.75 0C2.57436 0 0 2.57436 0 5.75C0 8.92564 2.57436 11.5 5.75 11.5C7.06725 11.5 8.28105 11.0571 9.25057 10.312L12.4017 13.4623L12.4858 13.5349C12.7794 13.7528 13.196 13.7286 13.4623 13.4623C13.7552 13.1694 13.7552 12.6945 13.4623 12.4017L10.312 9.25057C11.0571 8.28105 11.5 7.06725 11.5 5.75ZM1.5 5.75C1.5 3.40279 3.40279 1.5 5.75 1.5C8.09721 1.5 10 3.40279 10 5.75C10 8.09721 8.09721 10 5.75 10C3.40279 10 1.5 8.09721 1.5 5.75Z" fill="#3C3C43" fill-opacity="0.6" />
                                            </svg>
                                            <input type="text" className="text-sm outline-0 bg-transparent" onChange={(e) => {
                                                socket.emit("chat screen", { query: e.target.value, pageNumber: 1 });
                                                console.log(e.target.value)
                                            }} />
                                        </div>

                                        <div className="flex gap-3 py-2 border-t border-black/10 mt-2 ">
                                            {onlineUsers && onlineUsers.map((user, index) => {
                                                return (
                                                    <div key={index} className="flex flex-col justify-center items-center cursor-pointer" onClick={() => handleUserListClick(user)}>
                                                        <div className="bg-light/20  relative" title={`${user.username}`}>
                                                            {user.isOnline ? <div className="w-3 h-3 bg-black/60 rounded-full absolute z-1"></div> : null}
                                                            <img src={`${user.profilePic ? user.profilePic.small : ''}`} className="w-[56px] h-[56px] rounded-full" />
                                                        </div>
                                                        <div className="w-[60px] px-2">
                                                            <div className="font-12 text-center truncate">{user.username}</div>
                                                        </div>
                                                    </div>
                                                )
                                            })}
                                        </div>
                                        <div className="justify-content-end d-flex flex-column">
                                            <p className="text-xs font-medium mb-3">Messages</p>
                                            <div className="flex flex-col gap-2" >
                                                {
                                                    messages && messages.messages.map((data, index) => {
                                                        return (
                                                            <div key={index} className="flex gap-3" onClick={() => handleUserListClick({
                                                                username: data.username,
                                                                name: data.name,
                                                                profilePic: data.profilePic,
                                                            })}>
                                                                <div className="user-avatar">
                                                                    <img src={`${data.profilePic ? data.profilePic.small : ''}`} className="w-12 h-12 rounded-full" />
                                                                </div>
                                                                <div className="d-flex flex-column position-relative">
                                                                    {data.unseenCount !== 0 ?
                                                                        <div className="unseen-message">
                                                                            {data.unseenCount}
                                                                        </div>
                                                                        : null}
                                                                    <p className="text-[13px] font-medium">{data.name}</p>
                                                                    <div><h6 className={`${data.isSeen ? 'text-black/80' : 'text-black'} text-xs`}> {type && type === data.username ?
                                                                        <div className="flex items-center justify-start gap-1.5 h-4">
                                                                            <div >typing</div>
                                                                            <div className="w-1 h-1 rounded-full tidot bg-black/80"></div>
                                                                            <div className="w-1 h-1 rounded-full tidot bg-black/80"></div>
                                                                            <div className="w-1 h-1 rounded-full tidot bg-black/80"></div>
                                                                        </div> : data.message} </h6></div>
                                                                    <div className="text-[9px]">{data.createdAt}</div>
                                                                </div>
                                                            </div>
                                                        )
                                                    })
                                                }
                                            </div>
                                        </div>
                                    </div>
                                }
                                {
                                    inChatView &&
                                    <div className="px-2 relative ">
                                        <div className="flex  gap-4 border-b border-black/10 mb-2 py-2">
                                            <button type="button" className="" onClick={(event) => {
                                                event.preventDefault();
                                                socket.emit("leave private chat", chatScreen.username)
                                                socket.emit("leave chat")
                                                setChatView(false);
                                            }}>
                                                <svg width="10" height="18" viewBox="0 0 10 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                    <path d="M9.57712 1.28033C9.87002 0.987437 9.87002 0.512563 9.57712 0.21967C9.28423 -0.0732233 8.80936 -0.0732233 8.51646 0.21967L0.707078 8.02906C0.316554 8.41958 0.316554 9.05275 0.707078 9.44327L8.51646 17.2527C8.80936 17.5455 9.28423 17.5455 9.57712 17.2527C9.87002 16.9598 9.87002 16.4849 9.57712 16.192L2.12129 8.73616L9.57712 1.28033Z" className="fill-black" />
                                                </svg>
                                            </button>
                                            <div className="flex items-center gap-5">
                                                <img src={chatScreen.profilePic} className="w-[56px] h-[56px] rounded-full" />
                                                <div className="flex flex-col">
                                                    <h5 className="text-base font-bold">
                                                        {chatScreen.name}  <span className="text-sm font-medium">({chatScreen.username})</span>
                                                    </h5>
                                                    <p className="text-[11px] font-normal">{type && type === chatScreen.username ? 'typing...' : onlineStatus}</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div className="flex flex-col">
                                            {
                                                messages && messages.messages.map((message, index) => {
                                                    return (
                                                        <div key={index} className={`flex flex-wrap ${message.sentByMe ? 'justify-end' : 'justify-start'}`}>
                                                            {message.type === "text" &&
                                                                <div className="mx-2 py-[2px]">
                                                                    <div className={`${message.sentByMe ? 'bg-insta text-white' : 'bg-[#3C3C4318]'} py-2 px-3 rounded-[8px] text-sm font-normal`}>
                                                                        {message.message}
                                                                    </div>
                                                                    {message.isSeen ?
                                                                        <div className={`text-[11px] ${message.sentByMe ? 'text-right pr-1' : 'text-left pl-1'}`}>
                                                                            seen
                                                                        </div> : null}
                                                                </div>
                                                            }
                                                        </div>
                                                    )
                                                })
                                            }
                                        </div>
                                        <form className="bg-black/20 rounded-[50px] my-3  fixed bottom-0" onSubmit={handelSendMessage}>
                                            <div className="flex justify-between items-center px-2 w-full">
                                                <input type="text" value={message} className="bg-transparent text-sm outline-0  py-2.5 px-1 w-full" onChange={handleChange} />
                                                <button type="button" onClick={handleStoryComment}>
                                                    comment story
                                                </button>
                                                <div>
                                                    <button type="submit" className="w-7 h-7 bg-black/30 hover:bg-[#3797EF] flex justify-center items-center rounded-full" disabled={message.length === 0}>
                                                        <i className="fa fa-paper-plane text-sm"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                }
                            </div>
                        }
                    </div>
                </div >
            );
        }
        const domNode = document.getElementById('app');
        ReactDOM.render(
            <ErrorBoundary fallback={<p>Something went wrong</p>}>
                <App />
            </ErrorBoundary>
            , domNode);
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
</body>

</html>